from flask import Flask, request, render_template_string, send_file
import qrcode
import io

app = Flask(__name__)

HTML_TEMPLATE = """
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>QR Paiement Client</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        input, button { padding: 10px; margin: 10px; width: 300px; }
        img { margin-top: 20px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Générateur de QR Code</h1>
    <form method="POST">
        <input type="text" name="nom" placeholder="Nom du client" required><br>
        <input type="number" name="montant" placeholder="Montant à payer (FCFA)" required><br>
        <button type="submit">Générer QR Code</button>
    </form>

    {% if qr_code %}
        <h2>QR Code généré :</h2>
        <img src="{{ url_for('qr_image') }}" alt="QR Code">
    {% endif %}
</body>
</html>
"""

@app.route('/', methods=['GET', 'POST'])
def index():
    qr_code = False
    if request.method == 'POST':
        nom = request.form['nom']
        montant = request.form['montant']
        if nom and montant:
            contenu = f"Client: {nom}\nMontant: {montant} FCFA"
            img = qrcode.make(contenu)
            buffer = io.BytesIO()
            img.save(buffer, format="PNG")
            buffer.seek(0)
            app.qr_buffer = buffer
            qr_code = True
    return render_template_string(HTML_TEMPLATE, qr_code=qr_code)

@app.route('/qr.png')
def qr_image():
    if hasattr(app, 'qr_buffer'):
        return send_file(app.qr_buffer, mimetype='image/png')
    return "Aucun QR code généré", 404

if __name__ == '__main__':
    app.run(debug=True)